# Moodle Staging Environment Configuration
# This file contains staging-specific settings for Dokploy deployment
# Copy these values to Dokploy environment variables for each service

# =============================================================================
# DATABASE CONFIGURATION (MariaDB Service)
# =============================================================================
DB_TYPE=mariadb
DB_HOST=moodle-mariadb
DB_PORT=3306

# Database credentials - CHANGE THESE FOR PRODUCTION
DB_NAME=moodle
DB_USER=moodleuser
DB_PASSWORD=CHANGE_ME_staging_db_password_2024
DB_ROOT_PASSWORD=CHANGE_ME_staging_root_password_2024

# Database table prefix
DB_PREFIX=mdl_

# =============================================================================
# MOODLE CONFIGURATION (PHP Service)
# =============================================================================
# IMPORTANT: Update this to your actual staging domain
MOODLE_WWWROOT=https://staging.yourdomain.com

# Enable debug mode for staging (set to false for production)
MOODLE_DEBUG=true

# Email configuration
MOODLE_MAIL_NOREPLY=noreply@yourdomain.com
MOODLE_MAIL_PREFIX=[Moodle Staging]

# Reverse proxy settings (required for Dokploy)
MOODLE_REVERSEPROXY=true
MOODLE_SSLPROXY=true

# Moodle data directory (internal container path)
MOODLE_DATAROOT=/var/www/moodledata

# =============================================================================
# MINIO S3 STORAGE CONFIGURATION (MinIO Service)
# =============================================================================
# MinIO credentials - CHANGE THESE FOR PRODUCTION
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=CHANGE_ME_staging_minio_password_2024

# MinIO region and bucket
MINIO_REGION=us-east-1
MINIO_BUCKET=moodle

# S3 configuration for Moodle (PHP Service)
# Note: Use internal service name for endpoint
S3_ENDPOINT=http://moodle-minio:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=CHANGE_ME_staging_minio_password_2024
S3_BUCKET=moodle
S3_REGION=us-east-1

# =============================================================================
# DOKPLOY SERVICE NAMES
# =============================================================================
# These are the service names in Dokploy that services use to communicate
# Update these if you change service names in Dokploy

# Database service hostname
MARIADB_SERVICE_NAME=moodle-mariadb

# PHP-FPM service hostname
PHP_SERVICE_NAME=moodle-php

# Nginx service hostname
NGINX_SERVICE_NAME=moodle-nginx

# MinIO service hostname
MINIO_SERVICE_NAME=moodle-minio

# =============================================================================
# NOTES FOR DOKPLOY CONFIGURATION
# =============================================================================
#
# SERVICE 1: MariaDB (moodle-mariadb)
# ------------------------------------
# Environment variables to set:
#   - MARIADB_DATABASE
#   - MARIADB_USER
#   - MARIADB_PASSWORD
#   - MARIADB_ROOT_PASSWORD
#
# Volumes:
#   - /var/lib/mysql → mariadb_data (named volume)
#
# Build context: ./docker/mariadb
# Dockerfile: Dockerfile
# Port: Internal only (no external port)
#
# SERVICE 2: PHP-FPM (moodle-php)
# --------------------------------
# Environment variables to set:
#   - DB_TYPE, DB_HOST, DB_NAME, DB_USER, DB_PASSWORD, DB_PORT, DB_PREFIX
#   - MOODLE_WWWROOT, MOODLE_DATAROOT, MOODLE_DEBUG
#   - MOODLE_MAIL_NOREPLY, MOODLE_MAIL_PREFIX
#   - MOODLE_REVERSEPROXY, MOODLE_SSLPROXY
#   - S3_ENDPOINT, S3_ACCESS_KEY, S3_SECRET_KEY, S3_BUCKET, S3_REGION
#
# Volumes:
#   - /var/www/moodledata → moodledata (named volume, shared with nginx)
#
# Build context: . (project root)
# Dockerfile: docker/php/Dockerfile
# Port: Internal only (9000 for FastCGI)
# Dependencies: moodle-mariadb (must be healthy)
#
# SERVICE 3: Nginx (moodle-nginx)
# --------------------------------
# No environment variables needed
#
# Volumes:
#   - /var/www/moodledata → moodledata (named volume, shared with php, read-only)
#
# Build context: ./docker/nginx
# Dockerfile: Dockerfile
# Port: 80:80 (or use Dokploy reverse proxy)
# Domain: staging.yourdomain.com (configure in Dokploy)
# SSL: Enable Let's Encrypt in Dokploy
# Dependencies: moodle-php
#
# SERVICE 4: MinIO (moodle-minio)
# --------------------------------
# Use official image: minio/minio:latest
#
# Environment variables to set:
#   - MINIO_ROOT_USER
#   - MINIO_ROOT_PASSWORD
#   - MINIO_REGION_NAME
#
# Volumes:
#   - /data → minio_data (named volume)
#   - ./docker/minio/init.sh:/docker-entrypoint-initdb.d/init.sh:ro (optional)
#
# Port: 9000:9000 (API, internal), 9001:9001 (Console, optional external)
# Command: server /data --console-address ":9001"
#
# =============================================================================
# PRODUCTION ENVIRONMENT
# =============================================================================
# For production deployment:
# 1. Create .env.production with production-specific values
# 2. Use strong, randomly generated passwords
# 3. Set MOODLE_DEBUG=false
# 4. Update MOODLE_WWWROOT to production domain
# 5. Configure separate database with production data
# 6. Set up automated backups in Dokploy
# 7. Review security checklist in DOKPLOY.md
